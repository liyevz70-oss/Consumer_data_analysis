
-- Total revenue generated by male and female
SELECT GENDER, SUM(PURCHASE_AMOUNT) AS revenue FROM customer_eda GROUP BY GENDER;

-- 2
SELECT CUSTOMER_ID, PURCHASE_AMOUNT FROM customer_eda 
WHERE DISCOUNT_APPLIED = 'Yes'
AND PURCHASE_AMOUNT >= (SELECT AVG(PURCHASE_AMOUNT) FROM customer_eda);

--3
SELECT ITEM_PURCHASED, ROUND(AVG(TO_NUMBER(REVIEW_RATING)), 2) AS "Average Product Rating"
FROM customer_eda GROUP BY ITEM_PURCHASED 
ORDER BY AVG(TO_NUMBER(REVIEW_RATING)) DESC
FETCH FIRST 5 ROWS ONLY;

-- 4
SELECT SHIPPING_TYPE, ROUND(AVG(PURCHASE_AMOUNT), 2) AS AVG_PURCHASE 
FROM customer_eda
WHERE SHIPPING_TYPE IN ('Standard', 'Express')
GROUP BY SHIPPING_TYPE;

-- 5
SELECT SUBSCRIPTION_STATUS, COUNT(CUSTOMER_ID) AS total_customers,
ROUND(AVG(PURCHASE_AMOUNT), 2) AS avg_spend, ROUND(SUM(PURCHASE_AMOUNT), 2) AS total_revenue
FROM customer_eda 
GROUP BY SUBSCRIPTION_STATUS 
ORDER BY total_revenue DESC, avg_spend DESC;

-- 6
SELECT ITEM_PURCHASED, ROUND(100 * SUM(CASE WHEN DISCOUNT_APPLIED = 'Yes' THEN 1 ELSE 0 END)/COUNT(*), 2) AS discount_rate 
FROM customer_eda 
GROUP BY ITEM_PURCHASED 
ORDER BY discount_rate DESC
FETCH FIRST 5 ROWS ONLY;

-- 7
WITH customer_type AS (
    SELECT CUSTOMER_ID, PREVIOUS_PURCHASES,
        CASE
            WHEN PREVIOUS_PURCHASES = 1 THEN 'New'
            WHEN PREVIOUS_PURCHASES BETWEEN 2 AND 10 THEN 'Returning'
            ELSE 'Loyal' 
        END AS customer_segment 
    FROM customer_eda
)
SELECT customer_segment, COUNT(*) AS "Number of Customers" 
FROM customer_type
GROUP BY customer_segment;

-- 8
WITH item_counts AS (
    SELECT CATEGORY, ITEM_PURCHASED, COUNT(CUSTOMER_ID) AS total_orders,
    ROW_NUMBER() OVER(PARTITION BY CATEGORY ORDER BY COUNT(CUSTOMER_ID) DESC) AS item_rank
    FROM customer_eda 
    GROUP BY CATEGORY, ITEM_PURCHASED
)
SELECT item_rank, CATEGORY, ITEM_PURCHASED, total_orders 
FROM item_counts
WHERE item_rank <= 3;

-- 9
SELECT SUBSCRIPTION_STATUS, COUNT(CUSTOMER_ID) AS repeat_buyers 
FROM customer_eda
WHERE PREVIOUS_PURCHASES > 5 
GROUP BY SUBSCRIPTION_STATUS;

-- 10
SELECT AGE_GROUP, SUM(PURCHASE_AMOUNT) AS total_revenue 
FROM customer_eda
GROUP BY AGE_GROUP 
ORDER BY total_revenue DESC;

COMMIT;
